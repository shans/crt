<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="crt-review-display.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">

<script src="DONOTCOMMIT.js"></script>
<script src="codereview-summarize.js"></script>

<dom-module id="crt-review">
  <template>
    <iron-ajax
      auto
      params="{{params}}"
      url="https://codereview.chromium.org/api/{{issue}}"
      on-response="handleResponse"></iron-ajax>
    <paper-toggle-button active={{debug}}>Debug</paper-toggle-button>
    <crt-review-display debug$={{debug}} data={{data}}></crt-review-display>
  </template>
<script>

Polymer({
  is: 'crt-review',

  properties: {
    params: { type: Object, value: function() { return { messages: true } } },
    issue: Number,
    data: { type: Object , value: function() { return { } } },
    debug: false
  },

  handleResponse: function(e) {
    this.summarize(e.detail.response).then(data => this.set("data", data));
  },

  summarize: function(data) {
    data = JSON.parse(JSON.stringify(data));
    return summarize(data);
  }

});
</script>
</dom-module>
