<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="crt-review-display">
  <template>
    <style>
      .debug {
        display: none;
      }
      :host[debug] .debug {
        display: block;
      }
    </style>
    <div>
      <div class='debug'>
      from {{data.owner_email}} ({{datePart(data.created)}}):

      <h3>{{data.subject}}</h3>

      <pre>{{data.description}}</pre>

      <p>Reviewed by {{data.reviewers}}</p>    

      <p>{{issueStatus(data.commit, data.closed, data.landed_days_ago)}}</p>

      </div>
      <hr><template is='dom-repeat' items={{data.messages}}>
        <template is='dom-if' if={{item.summary}}>
          {{formatDate(item)}}: {{item.summary}}<br>
          {{item.waitClass}}<br>
          <br>
          {{item.type}} $$ {{item.reviewers}} $$ {{item.sender}}
        </template>
        <template is='dom-if' if={{!item.summary}}>
        <p>
          {{formatDate(item)}} from {{item.sender}}<br>
          {{item.waitClass}}<br>
          <br>
          reviewers: {{item.reviewers}}<br>
          lgtmers: {{item.lgtm}}<br>
          all_lgtm: {{item.all_lgtm}}<br>
          <br>
          patchset: {{item.patchset}}<br>
          recipients_count: {{item.recipients.length}}<br>
          approval: {{item.approval}}<br>
          text: <pre>{{item.text}}</pre><br>
          issue_was_closed: {{item.issue_was_closed}}<br>
          auto_generated: {{item.auto_generated}}<br>
          disapproval: {{item.disapproval}}<br>
        </p>
        </template>
        <hr>
      </template>
    </div> 
  </template>
<script>
Polymer({
  is: 'crt-review-display',

  properties: {
    data: { type: Object , value: function() { return { } } },
    debug: false
  },

  datePart: function(d) {
    return new Date(d).toDateString();
  },

  issueStatus: function(committed, closed, landed) {
    if (committed)
      return `committed ${landed} days ago`;
    if (closed)
      return `closed ${landed} days ago`;
    return "pending";
  },

  formatDate: function(message) {
    if (message.delta) {
      var minutes = Math.floor(message.delta / 60 / 1000);
      var hours = Math.floor(minutes / 60);
      minutes -= hours * 60;
      return `${hours}h ${minutes}m later`;
    } else {
      return message.date;
    }
  }
});
</script>
</dom-module>
